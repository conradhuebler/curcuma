# AI-Generated Changes Log

This file tracks significant improvements, refactorings, and new features generated by AI assistants (primarily Claude).

Format: One line per change, newest first.

## January 2026

- **GFN-FF Fragment-Constrained EEQ Charges (Jan 31)**: Implemented molecular fragment detection (BFS) and per-fragment charge constraints in the EEQ solver, expanding the augmented matrix size to `natoms + nfrag`, correcting charge redistribution in multi-fragment systems and reducing Coulomb energy error for a 231-atom complex from 6.5 mEh to 0.65 mEh (10× improvement)
- **GFN-FF HB/XB Parameter Refinement (Jan 17)**: Implemented context-dependent basicity and acidity overrides for Hydrogen and Halogen bonds, added detector for carbenes, carbonyls, nitro groups, and amides, hardcoded XB acceptor basicity to 1.0 per Fortran reference, added sulfur neighbor filter and group 4 base charge criterion for XB detection, significantly improving non-covalent interaction accuracy
- **GFN-FF EEQ Charge Fine-Tuning (Jan 17)**: Aligned EEQ implementation with GFN-FF Fortran reference, removed non-standard neighbor electronegativity correction, added Group 6 (O, S) and Group 7 (Halogens) charge-dependent polarizability (alpeeq) corrections, implemented amide hydrogen electronegativity shift (-0.02 Eh) for H bonded to pi-system nitrogen, refined nitrogen hardness corrections with pi-system (ff=-0.14) and amide (ff=-0.16) factors, added detectPiSystem and detectAmideNitrogens helpers to EEQSolver, improved Coulomb energy accuracy for CH3OCH3 by 82% (8.3% error -> 1.5% error)
- **D4 Dispersion Weighting Fix (Jan 17)**: Corrected D4 weighting formula to use CN-only weighting instead of CN+charge combined, aligned with GFN-FF hybrid dispersion model and Fortran reference gfnff_gdisp0.f90:405, changed default dispersion method to D4
- **GFN-FF Angle Parameter Refinement (Jan 9-10)**: Implemented complete port of element-specific angle corrections from Fortran GFN-FF, added amide detection via FunctionalGroupDetector, implemented pi-bond order approximation for nitrogen angle force constant scaling, achieving 86% angle energy error reduction (9.4% -> 1.3%)
- **Torsion Gradient and NCI Support (Jan 13)**: Implemented full analytical gradients for all torsion types including NCI-specific damping derivatives, matching Fortran engrad formulas exactly

## December 2025

- **UFF-D3 and GFN-FF Native D3 Integration (Dec 19)**: Implemented UFF-D3 hybrid method combining UFF bonded terms with validated native D3 dispersion (10/11 molecules <1% error), replaced GFN-FF's generateGFNFFDispersionPairs() with direct D3ParameterGenerator integration eliminating ~200 lines of duplicate dispersion code, added GenerateUFFD3Parameters() to ForceFieldGenerator, implemented CalculateD3DispersionContribution() in ForceFieldThread with multi-threaded parallelization, both UFF-D3 and GFN-FF now use identical validated D3 infrastructure (PBE0/BJ parameters for UFF-D3: a1=0.4145, a2=4.8593, s8=1.2177), code consolidation achieved with single D3 implementation shared across all force field methods, method routing configured for "uff-d3" command
- **D3 Test Suite Expansion (Dec 19)**: Added triose (66 atoms) and monosaccharide (27 atoms) to comprehensive D3 test suite, validates accuracy on larger sugar molecules (351-2145 pairs), 10/11 molecules now passing with <1% error, tests complex organic systems to ensure D3 reliability at scale
- **D3 Dispersion Triangular Indexing Fix (Dec 19)**: Fixed critical bug in C6 reference data access - Fortran 1-based formula `ic = j + i*(i-1)/2` requires `ic = j + i*(i+1)/2` for 0-based C++, reduced heteronuclear pair errors from 20-87% to <1% (8/9 test molecules now passing: H₂ 0.026%, HCl 0.036%, CH₃OCH₃ 0.659%), O₃ outlier at 10.5% (geometry/CN-specific), D3 implementation now production-ready
- **EEQ Consolidation and D4 Integration (Dec 14)**: Extracted EEQ solver from embedded GFN-FF (2200+ lines) into standalone `eeq_solver.{h,cpp}` (~800 lines) in ff_methods/, integrated with D4ParameterGenerator for charge-weighted C6 coefficients with Gaussian charge-state weighting (expected +20-30% accuracy), refactored GFN-FF to delegate to EEQSolver eliminating ~340 lines of duplication, all tests passing with zero functional regression

## November 2025

- **Phase 2a+2b: Platform-Independent External Dependency Discovery**: Plumed2 now uses find_library() with fallbacks (local build, system libs), DFT-D4 auto-discovers LAPACK/BLAS via find_package(), both with manual override via env vars, CMake reports discovered libraries, tested and verified working on Linux, removes hardcoded .so path and manual env var requirements
- **Phase 1b External Dependency Verification**: Verified all 14 external dependencies have proper conditional compilation guards (USE_XTB, USE_TBLITE, USE_D3, USE_D4, USE_ULYSSES, USE_Plumed), MethodFactory runtime checks functional, CMake flag propagation correct, identified 2 minor issues (Plumed2 hardcoded .so path, DFT-D4 manual config), Phase 1a+1b now production-ready with clean builds at any feature level

## October 2025

- **SimpleMD Coarse Graining Integration (Oct 30)**: Automatic CG system detection (isCGSystem), periodic boundary condition wrapping (applyPeriodicBoundaryConditions), 10x timestep scaling for pure CG systems, CLI test case (simplemd/08_cg_spheres), complete CG MD support ready for production
- **Coarse Graining Phases 1-4 Complete**: Molecule CG detection (isCGSystem, getCGAtoms), ForceField JSON parameter loading (cg_default, cg_per_atom, pair_interactions), VTF reader/writer for CG structures and trajectories, comprehensive test suite (9+6+1 test cases), spherical CG particles fully functional for Casino MC, ready for SimpleMD integration
- **Help System Migration to ParameterRegistry**: 3-tier migration complete, 300+ lines of duplicate hardcoded help text eliminated, 4 modules refactored with registry-based printHelp(), 3 modules enhanced with new printHelp() methods, 2 modules (casino, modern_optimizer) with complete PARAM definitions (29 new parameters), single source of truth for all help documentation, automatic help generation for new modules
- **CurcumaOpt ParameterRegistry Migration - JSON Null Bug Fixed**: 37 parameters defined, ~30 Json2KeyWord calls eliminated, CurcumaOptJson replaced with ParameterRegistry, LBFGS parameter access migrated, fixes critical JSON null bug affecting 11/26 CLI tests, optimization now functional
- **ForceField Inversion Bug Fixed**: Copy-paste error in ForceFieldGenerator::setBonds() causing vector out-of-bounds crash, changed incorrect m_stored_bonds[i] to m_stored_bonds[j] access
- **ConfScan ConfigManager Migration - Multi-Module Architecture Complete**: ConfigManager extended with Multi-Module support, 59 Json2KeyWord calls eliminated, 41 parameters defined, RMSD/Ripser parameters imported via nested notation (-rmsd.method, -rmsd.threads), sLX parsing simplified from ~90 to ~50 lines, #pragma message hack removed, exportModule() API for submodule configs, DRY principle (RMSD params defined once), 100% backward compatible
- **SimpleMD ConfigManager Migration Complete**: 82 Json2KeyWord calls eliminated (LARGEST migration!), CurcumaMDJson removed, ~350 LOC boilerplate eliminated, 48 parameters defined, 100% backward compatible
- **RMSD ConfigManager Migration Complete**: 33 Json2KeyWord calls eliminated, RMSDJson removed, enum-based method selection, simplified element parsing, 100% backward compatible via aliases, build successful
- **ConfigManager Production-Ready**: Type-safe parameter access layer implemented (analysis.cpp proof-of-concept: 37 calls � elegant get<T>())
- **Universal Parameter Registry System Complete**: Macro-based parameter definitions, auto-generation at build time, 25 parameters in analysis module
- **Complete Trajectory Analysis Output**: CSV implementation, bracket notation support, stream refactoring for flexible output
- **Unified Molecular Analysis with Trajectory Statistics**: Moving averages, cumulative statistics, multi-metric tracking
- **EnergyCalculator Architecture Refactoring**: Polymorphic ComputationalMethod interface, MethodFactory priority-based resolution, seamless API migration
- **Universal Verbosity System**: Consistent 0-3 levels across all QM/MM methods, silent optimization support, structured scientific output
- **Physical Architecture Restructuring**: All computational methods consolidated under src/core/energy_calculators/
- **Enhanced Topological Data Analysis**: dMatrix integration via TDAEngine, publication-grade analysis, complete migration path
